<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Profil Saya</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="logo">Sewa<span style="color: #4a69bd;">Mates</span></a>
        <div id="nav-menu" class="nav-links" style="width: 100%;"></div>
    </nav>

    <div class="container">
        <div style="background: white; padding: 30px; border-radius: 20px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 20px;">
            <div style="width: 80px; height: 80px; background: #dfe6e9; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; color: #636e72;">
                <i class="fas fa-user"></i>
            </div>
            <div>
                <h2 id="profileName" style="margin: 0;">User</h2>
                <p id="profileRole" style="margin: 5px 0; color: #666;">Member</p>
            </div>
        </div>

        <div id="section-provider" style="display: none;">
            <h3 style="margin-bottom: 15px; color: #4a69bd;">ðŸ“Š Dashboard Keuangan Toko</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div style="background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; padding: 20px; border-radius: 15px;">
                    <p style="margin: 0; opacity: 0.8;">Total Pendapatan</p>
                    <h2 id="totalRevenue" style="margin: 5px 0; font-size: 28px;">Rp 0</h2>
                </div>
                <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                    <p style="margin: 0; color: #888;">Barang Disewakan</p>
                    <h2 id="totalItems" style="margin: 5px 0; color: #333;">0</h2>
                </div>
                 <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                    <p style="margin: 0; color: #888;">Transaksi Sukses</p>
                    <h2 id="totalTransactions" style="margin: 5px 0; color: #2ecc71;">0</h2>
                </div>
            </div>
        </div>

        <div id="section-renter" style="display: none;">
            <h3 style="margin-bottom: 15px; color: #4a69bd;">ðŸ“¦ Riwayat Pesanan Saya</h3>
            <div id="myOrderList" style="margin-top: 15px;"></div>
        </div>
        
    </div>

    <script src="js/data.js"></script>
    <script src="js/auth.js"></script>
    <script>
        initData();
        const user = checkAuth();
        if(!user) window.location.href = 'login.html';

        document.getElementById('profileName').innerText = user.name;

        // Cek Mode Saat Ini (Renter / Provider)
        const currentMode = sessionStorage.getItem('appMode') || 'renter';
        
        if (currentMode === 'provider') {
            // --- TAMPILAN MODE PENYEDIA ---
            document.getElementById('profileRole').innerText = 'Mode: Penyedia Barang';
            document.getElementById('section-provider').style.display = 'block';
            document.getElementById('section-renter').style.display = 'none';

            // Hitung Statistik
            const allProducts = getProducts();
            const myProducts = allProducts.filter(p => p.owner === user.name);
            const incomingOrders = getIncomingOrders(user.name); 
            const successOrders = incomingOrders.filter(o => o.status === 'approved' || o.status === 'done');
            const revenue = successOrders.reduce((sum, order) => sum + parseInt(order.total), 0);

            document.getElementById('totalRevenue').innerText = formatRupiah(revenue);
            document.getElementById('totalItems').innerText = myProducts.length + " Unit";
            document.getElementById('totalTransactions').innerText = successOrders.length + " Kali";

        } else {
            // --- TAMPILAN MODE PENYEWA ---
            document.getElementById('profileRole').innerText = 'Mode: Penyewa';
            document.getElementById('section-provider').style.display = 'none';
            document.getElementById('section-renter').style.display = 'block';

            // Render List Belanja
            const myOrders = getOrdersByRenter(user.name);
            const container = document.getElementById('myOrderList');

            if(myOrders.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:20px; background:white; border-radius:10px; color:#888;">Belum ada riwayat belanja.</div>';
            } else {
                myOrders.forEach(o => {
                    let badgeClass = 'bg-pending';
                    let statusText = 'Menunggu';
                    if(o.status === 'approved') { badgeClass = 'bg-approved'; statusText = 'Disetujui'; }
                    if(o.status === 'rejected') { badgeClass = 'bg-rejected'; statusText = 'Ditolak'; }

                    container.innerHTML += `
                        <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 15px; display: flex; align-items: center; gap: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.02);">
                            <img src="${o.productImg}" style="width:60px; height:60px; object-fit:cover; border-radius:10px;">
                            <div style="flex:1;">
                                <h4 style="margin:0;">${o.productName}</h4>
                                <p style="margin:5px 0; font-size:13px; color:#666;">
                                    Total: <b>${formatRupiah(o.total)}</b> (${o.days} Hari)
                                </p>
                            </div>
                            <span class="badge ${badgeClass}">${statusText}</span>
                        </div>
                    `;
                });
            }
        }
    </script>
</body>
</html>